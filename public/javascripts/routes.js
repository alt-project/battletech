// Generated by CoffeeScript 1.6.3
(function() {
  var drawWeapons, getMechClass;

  drawWeapons = function() {
    return WEAPONS.forEach(function(weapon) {
      return $('.weapons .' + weapon.type).append(Templates.weapon(weapon));
    });
  };

  window.drawMech = function() {
    var bodyparts, context, part, part_info, partname, slot, slots, tokens, _i, _len, _ref, _results;
    $('.parts').empty().show();
    for (part in PARTS) {
      part_info = PARTS[part];
      context = {
        name: part,
        armor: active_mech['ARMOR_' + part],
        structure: active_mech['STRUCTURE_' + part],
        armor_remaining: active_mech['armor_' + part],
        structure_remaining: active_mech['structure_' + part]
      };
      $('.parts').append(Templates.part(context));
    }
    $('.crits').empty().show();
    bodyparts = {};
    _ref = active_mech.getCriticalSlots();
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      slot = _ref[_i];
      tokens = slot.slot.split('_');
      partname = tokens.slice(1, +(tokens.length - 2) + 1 || 9e9).join(' ');
      if (bodyparts[partname] == null) {
        bodyparts[partname] = [];
      }
      bodyparts[partname].push({
        item: slot.item,
        position: tokens[tokens.length - 1] * 1
      });
    }
    _results = [];
    for (partname in bodyparts) {
      slots = bodyparts[partname];
      slots = slots.sort(function(a, b) {
        return a.position - b.position;
      });
      console.log(slots);
      $('.crits').append("<h3>" + partname + "</h3>");
      _results.push((function() {
        var _j, _len1, _results1;
        _results1 = [];
        for (_j = 0, _len1 = slots.length; _j < _len1; _j++) {
          slot = slots[_j];
          _results1.push($('.crits').append("<div>" + slot.position + ". " + slot.item + "</div>"));
        }
        return _results1;
      })());
    }
    return _results;
  };

  bone.set('log', false);

  bone.set('templates', Templates);

  drawWeapons();

  window.active_player = null;

  window.active_mech = null;

  window.router = bone.router({
    routes: {
      '': 'root',
      ':player': 'player',
      ':player/:mech': 'mech'
    },
    root: function() {
      window.active_player = null;
      return bone.mount('.players', 'players', {
        data: players,
        refresh: true
      });
    },
    player: function(player_name) {
      window.active_player = _.findWhere(players, {
        name: player_name
      });
      bone.mount('.players', 'players', {
        data: active_player.name
      });
      bone.mount('.mechs', 'mechs', {
        data: active_player.mechs
      });
      return $('.parts').hide();
    },
    mech: function(player_name, mech_name) {
      var MechClass;
      this.player(player_name);
      window.active_mech = _.findWhere(active_player.mechs, {
        name: mech_name
      });
      MechClass = getMechClass(window.active_mech.type);
      window.active_mech = new MechClass(active_mech);
      return drawMech();
    }
  });

  getMechClass = function(type) {
    return _.find(MECHS, function(MECH) {
      return MECH.prototype.NAME === type;
    });
  };

  bone.router.start();

}).call(this);
